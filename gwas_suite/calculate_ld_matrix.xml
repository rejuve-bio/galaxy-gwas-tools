<tool id="calculate_ld_matrix" name="Calculate LD Matrix" version="1.0.2">
    <description>Calculates an LD matrix for a genomic region using PLINK</description>

    <requirements>
        <!-- The pandas requirement is still needed for the Python script -->
        <requirement type="package" version="2.1.0">pandas</requirement>
    </requirements>

    <command detect_errors="exit_code"><![CDATA[
        # Create a directory for the reference files and link the inputs into it
        mkdir plink_ref &&
        ln -s '$plink_bed' 'plink_ref/${population}.${chromosome}.bed' &&
        ln -s '$plink_bim' 'plink_ref/${population}.${chromosome}.bim' &&
        ln -s '$plink_fam' 'plink_ref/${population}.${chromosome}.fam' &&

        python3 "$__tool_directory__/calculate_ld_matrix.py"
            --sumstats "$sumstats_file"
            --plink_ref_dir "plink_ref"
            --chromosome $chromosome
            --lead_variant "$lead_variant"
            --window $window
            --population "$population"
            --output_ld "$output_ld"
            --output_log "$output_log"
    ]]></command>

    <inputs>
        <param name="sumstats_file" type="data" format="tsv" label="Summary Statistics with IDs"/>
        <param name="plink_bed" type="data" format="binary" label="PLINK BED file"/>
        <param name="plink_bim" type="data" format="tabular" label="PLINK BIM file"/>
        <param name="plink_fam" type="data" format="tabular" label="PLINK FAM file"/>
        <param name="chromosome" type="integer" value="1" label="Chromosome of Reference Panel"/>
        <param name="lead_variant" type="text" label="Lead Variant ID"/>
        <param name="window" type="integer" value="500" label="Window Size (in kb)"/>
        <param name="population" type="text" value="EUR" label="Population Prefix"/>
    </inputs>

    <outputs>
        <data name="output_ld" format="txt.gz" label="${tool.name} on ${on_string}: LD Matrix"/>
        <data name="output_log" format="txt" label="${tool.name} on ${on_string}: PLINK Log"/>
    </outputs>

    <help>
        This tool calculates the Linkage Disequilibrium (LD) matrix for a group of SNPs in a specific genomic region.
    </help>
</tool>
