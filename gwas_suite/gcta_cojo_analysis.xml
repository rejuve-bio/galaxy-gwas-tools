<tool id="gcta_cojo_analysis_custom" name="GCTA-COJO Analysis with preprocessing" version="1.0">
  <description>Run GCTA COJO analysis with automatic summary stats preprocessing</description>

  <requirements>
    <requirement type="package" version="1.94.1">gcta</requirement>
  </requirements>

  <command><![CDATA[
mkdir -p plink_input && \
cp "${plink_bed}" plink_input/plink.bed && \
cp "${plink_bim}" plink_input/plink.bim && \
cp "${plink_fam}" plink_input/plink.fam && \
awk 'NR==1 {print "SNP\tA1\tA2\tfreq\tb\tse\tp\tN"} NR>1 {print $1"\t"$4"\t"$5"\t"$6"\t"$11"\t"$12"\t"$14"\t"$8}' "${cojo_file}" > cojo_input.dat && \
~/bin/gcta64 --bfile plink_input/plink --cojo-file cojo_input.dat --cojo-slct --out gcta_output &> gcta.log
  ]]></command>

  <inputs>
    <param name="plink_bed" type="data" format="bed" label="PLINK BED file" />
    <param name="plink_bim" type="data" format="bim" label="PLINK BIM file" />
    <param name="plink_fam" type="data" format="fam" label="PLINK FAM file" />
    <param name="cojo_file" type="data" format="tabular" label="Summary Statistics file" />
  </inputs>

  <outputs>
    <data name="cojo_output" format="tabular" label="GCTA COJO Output" />
    <data name="log" format="txt" label="GCTA Log File" />
  </outputs>

  <stdout>gcta_output.jma.cojo</stdout>
  <stderr>gcta.log</stderr>

  <help>
    This tool runs GCTA COJO analysis on your data. It first preprocesses the summary statistics file to the required format.
    
    Input summary statistics must have columns including SNP, A1, A2, freq, b, se, p, N, etc. The tool extracts the necessary columns automatically.
  </help>
</tool>
