<tool id="gwas_sumstats_harmoniser" name="GWAS Sumstats Harmoniser" version="1.0.0">
    <description>Prepare reference data or harmonise GWAS summary statistics using Nextflow-based GWAS harmoniser</description>

    <requirements>
        <requirement type="package" version="24.04.8">nextflow</requirement>
        <requirement type="package">bgzip</requirement>
        <requirement type="package">tabix</requirement>
        <requirement type="package">awk</requirement>
        <requirement type="package">coreutils</requirement>

    </requirements>

    <command detect_errors="exit_code">
        <![CDATA[
        #if $mode.choice == "setup"
            bash "$__tool_directory__/harmonizer_setup.sh" "$ref_dir" "$code_repo"
        #else
            bash "$__tool_directory__/harmonizer.sh" "$input" "$build" "$threshold" "$ref_dir" "$code_repo"
        #end if
        ]]>
    </command>




    <inputs>
        <conditional name="mode">
            <param name="choice" type="select" label="Choose operation mode">
                <option value="setup">Prepare reference data</option>
                <option value="harmonise" selected="true">Harmonise GWAS summary stats</option>
            </param>
            <when value="setup">
                <param name="ref_dir" type="text" label="Reference directory path" help="Path to where reference data will be stored or updated."/>
                <param name="code_repo" type="text" value="/mnt/hdd_1/ofgeha/gwas-sumstats-harmoniser" label="Path to gwas-sumstats-harmoniser code repository"/>
            </when>
            <when value="harmonise">
                <param name="input" type="data" format="tabular" label="GWAS summary statistics file (.tsv or .tsv.gz)"/>
                <param name="build" type="select" label="Genome build">
                    <option value="GRCh37">GRCh37 (hg19)</option>
                    <option value="GRCh38">GRCh38 (hg38)</option>
                </param>
                <param name="threshold" type="float" value="0.99" label="Palindromic variant threshold"/>
                <param name="ref_dir" type="text" label="Reference data directory path (prepared previously)"/>
                <param name="code_repo" type="text" value="/mnt/hdd_1/ofgeha/gwas-sumstats-harmoniser" label="Path to gwas-sumstats-harmoniser code repository"/>
            </when>
        </conditional>
    </inputs>

    <outputs>
        <data name="log" format="txt" label="Harmoniser log file"/>
    </outputs>

    <help>
This tool runs the **GWAS Sumstats Harmoniser** Nextflow workflow to prepare reference data or harmonise GWAS summary statistics.

### Modes

**1. Setup mode â€” prepare reference data**
    Outputs include harmonised summary statistics and workflow logs.
    </help>
</tool>